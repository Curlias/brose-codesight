<Project Sdk="Microsoft.NET.Sdk.Web">
  <PropertyGroup>
    <TargetFramework>net8.0</TargetFramework>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
  </PropertyGroup>

  <!-- Include static site files from repo's src-modern so they are available at publish time -->
  <ItemGroup>
    <Content Include="../src-modern/**"> 
      <CopyToPublishDirectory>PreserveNewest</CopyToPublishDirectory>
    </Content>
  </ItemGroup>

  <!-- Also include built distribution files (dist-modern) so hashed CSS/JS are published -->
  <ItemGroup>
    <Content Include="..\dist-modern\**\*.*">
      <CopyToPublishDirectory>PreserveNewest</CopyToPublishDirectory>
    </Content>
  </ItemGroup>

  <!-- Ensure static files are placed under publish wwwroot folder after publish -->
  <Target Name="CopyStaticContentToWwwroot" AfterTargets="Publish">
    <Message Text="Copying static content from ../src-modern to $(PublishDir)wwwroot" Importance="high" />
    <MakeDir Directories="$(PublishDir)wwwroot" />
    <ItemGroup>
      <_StaticFiles Include="@(Content)" />
    </ItemGroup>
    <Copy SourceFiles="@(_StaticFiles)"
          DestinationFiles="@(_StaticFiles->'$(PublishDir)wwwroot/%(RecursiveDir)%(Filename)%(Extension)')"
          SkipUnchangedFiles="true" />
  </Target>

  <!-- Copy dist-modern contents into publish wwwroot so hashed assets are served at /assets/... -->
  <Target Name="CopyDistModernToWwwroot" AfterTargets="Publish">
    <Message Text="Copying dist-modern into $(PublishDir)wwwroot" Importance="high" />
    <ItemGroup>
      <_DistFiles Include="..\dist-modern\**\*.*" />
      <!-- Also copy the built assets folder directly to wwwroot/assets -->
      <_DistAssetFiles Include="..\dist-modern\assets\**\*.*" />
    </ItemGroup>
    <Copy SourceFiles="@(_DistFiles)"
          DestinationFiles="@(_DistFiles->'$(PublishDir)wwwroot/%(RecursiveDir)%(Filename)%(Extension)')"
          SkipUnchangedFiles="true" />
    <MakeDir Directories="$(PublishDir)wwwroot/assets" />
    <Copy SourceFiles="@(_DistAssetFiles)"
          DestinationFiles="@(_DistAssetFiles->'$(PublishDir)wwwroot/assets/%(RecursiveDir)%(Filename)%(Extension)')"
          SkipUnchangedFiles="true" />
  </Target>
</Project>
